<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HATPI Data</title>
  <link rel="stylesheet" href="/static/lightcurves.css">
  <link rel="icon" href="/static/images/favicon.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body class="lightcurves-page">
  <!-- Left Sidebar Navigation -->
  <nav id="lightcurves-navigation">
    <a href="https://hatpi.org" class="nav-home-link">üè°</a>

    <!-- Search Form inside the Sidebar -->
    <div id="search-form-sidebar">

      <h2 class="nav-section-title">
        <img src="/static/icons/search.svg" alt="Gear Icon" class="nav-icon">
        Search
      </h2>
      <form method="POST">
        <label for="ra">
          <img src="/static/icons/RA.png" alt="Gear Icon" class="small-icon">
          RA (deg)</label>
        <input type="text" id="ra" name="ra" placeholder="e.g. 180.07" value="{{ ra|default('') }}" />

        <label for="dec">
          <img src="/static/icons/DEC.png" alt="Gear Icon" class="small-icon">
          DEC (deg)</label>
        <input type="text" id="dec" name="dec" placeholder="e.g. -83.553" value="{{ dec|default('') }}" />

        <label for="date_type">Date Type</label>
        <select id="date_type" name="date_type">
          <option value="datetime" {% if date_type=='datetime' %}selected{% endif %}>datetime</option>
          <option value="JD" {% if date_type=='JD' %}selected{% endif %}>JD</option>
        </select>
        <small>If "datetime", format is YYYY-MM-DD.<br />If "JD", enter float such as 2459990.5.</small>

        <label for="date_min">Date Min</label>
        <input type="text" id="date_min" name="date_min" placeholder="YYYY-MM-DD or 2459990.5"
          value="{{ date_min_input|default('') }}" />

        <label for="date_max">Date Max</label>
        <input type="text" id="date_max" name="date_max" placeholder="YYYY-MM-DD or 2459991.5"
          value="{{ date_max_input|default('') }}" />

        <button type="submit" class="visit-button">Search</button>
      </form>

    </div>

  </nav>

  <!-- Main content area for query results -->
  <main>

    <section id="upcoming">
      <div class="section-card">
        <!-- <div class="title-container">
          <div class="title-row">
            <h1 class="section-title">Upcoming Data Releases</h1>
          </div>
        </div> -->
        <div class="content-area">
          <h1 class="section-title">Upcoming Data Releases</h1>
          <p>
            We‚Äôre excited to announce that stitched light curves and high-resolution image stamps will soon be available
            for direct viewing and download. In the meantime, our frame search feature lets you explore HATPI‚Äôs
            observations to determine if we‚Äôve captured the astronomical phenomena you‚Äôre researching.
          </p>
        </div>
      </div>
    </section>


    <section id="results">
      {% if error %}
      <p class="error-text">{{ error }}</p>
      {% endif %}

      {% if message %}
      <p class="message-text">{{ message }}</p>
      {% endif %}

      {% if frames is none %}
      <div class="section-card">
        <div class="title-container">
          <div class="title-row">
            <h1 class="section-title">‚¨ÖÔ∏è Awaiting search</h1>
          </div>
        </div>
        <div class="content-area">
          <!-- placeholder for before query is submitted -->
        </div>
      </div>

      {% elif frames %}
      <div class="section-card">
        <!-- New Title Container Layout for Results -->
        <div class="title-container">
          <!-- First row: Frames Found -->
          <div class="title-row">
            <div class="search-info-box">
              Frames Found: {{ total_count }}
            </div>
          </div>
          <!-- Second row: Query details -->
          <div class="title-row search-info-row">
            <div class="search-info-box">RA: {{ ra|default('N/A') }}</div>
            <div class="search-info-box">DEC: {{ dec|default('N/A') }}</div>
            <div class="search-info-box">Date Min: {{ date_min_input|default('N/A') }}</div>
            <div class="search-info-box">Date Max: {{ date_max_input|default('N/A') }}</div>
          </div>
        </div>
        <div class="content-area">
          <div class="table-wrapper">
            <form method="post" class="pagination-form">
              <!-- preserve all your search inputs as hidden fields -->
              <input type="hidden" name="ra" value="{{ ra }}">
              <input type="hidden" name="dec" value="{{ dec }}">
              <input type="hidden" name="date_type" value="{{ date_type }}">
              <input type="hidden" name="date_min" value="{{ date_min_input }}">
              <input type="hidden" name="date_max" value="{{ date_max_input }}">

              <!-- pagination controls -->
              <button type="submit" name="page" value="{{ page - 1 }}" {% if page <=1 %}disabled{% endif %}>
                ‚Üê Prev
              </button>
              <span>Page {{ page }} of {{ total_pages }}</span>
              <button type="submit" name="page" value="{{ page + 1 }}" {% if page>= total_pages %}disabled{% endif %}>
                Next ‚Üí
              </button>
            </form>

            <table class="frames-table">
              <thead>
                <tr>
                  <th>Object</th>
                  <th>IHUID</th>
                  <th>FNUM</th>
                  <!-- <th>Path</th> -->
                  <th>Observation Time (UTC)</th>
                  <th>EXPTIME</th>
                  <th>Sky Background (ADU)</th>
                  <th>Moon Distance</th>
                  <th>Sun Elevation</th>
                </tr>
              </thead>
              <tbody>
                {% for f in frames %}
                <tr>
                  <td>{{ f.OBJECT }}</td>
                  <td>{{ f.IHUID }}</td>
                  <td>{{ f.FNUM }}</td>
                  <!-- <td>{{ f.relpath }}</td> -->
                  <td>{{ f.datetime_obs }}</td>
                  <td>{{ f.EXPTIME }}</td>
                  <td>{{ f.sky_bg|default('N/A') }}</td>
                  <td>{{ f.moondist|default('N/A') }}</td>
                  <td>{{ f.sunelev|default('N/A') }}</td>

                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      {% else %}
      <div class="section-card">
        <div class="title-container">
          <div class="title-row">
            <h2 class="section-title">Results</h2>
          </div>
        </div>
        <div class="content-area">
          <p>No frames found for that coordinate &amp; date range.</p>
        </div>
      </div>
      {% endif %}
    </section>

    <!-- CLI Query Card -->
    <div class="cli-section">
      <h1 class="section-title">Query the API from Your Terminal</h1>
      <div class="cli-query-container">

        <div class="cli-block">
          <pre id="pre-json" class="cli-query">
    # JSON
    <span class="command">curl</span> <span class="option">-X</span> <span class="value">POST</span> \
      <span class="option">-H</span> <span class="string">"Content-Type: application/json"</span> \
      <span class="option">-d</span> <span class="string">'{ "ra": "180.07", "dec": "-83.553", "date_type": "JD", "date_min": "2460048.60", "date_max": "2460048.63" }'</span> \
      <span class="url">'https://hatpi.org/api/data'</span>
          </pre>
          <button class="copy-button" data-target="pre-json">Copy JSON üìã</button>
        </div>

        <div class="cli-block">
          <pre id="pre-csv" class="cli-query">
    # CSV
    <span class="command">curl</span> <span class="option">-X</span> <span class="value">POST</span> \
      <span class="option">-H</span> <span class="string">"Content-Type: application/json"</span> \
      <span class="option">-d</span> <span class="string">'{ "ra": "180.07", "dec": "-83.553", "date_type": "JD", "date_min": "2460048.60", "date_max": "2460048.63" }'</span> \
      <span class="url">'https://hatpi.org/api/data?format=csv'</span>
          </pre>
          <button class="copy-button" data-target="pre-csv">Copy CSV üìã</button>
        </div>

        <div class="cli-block">
          <pre id="pre-votable" class="cli-query">
    # VOTable
    <span class="command">curl</span> <span class="option">-X</span> <span class="value">POST</span> \
      <span class="option">-H</span> <span class="string">"Content-Type: application/json"</span> \
      <span class="option">-d</span> <span class="string">'{ "ra": "180.07", "dec": "-83.553", "date_type": "JD", "date_min": "2460048.60", "date_max": "2460048.63" }'</span> \
      <span class="url">'https://hatpi.org/api/data?format=votable'</span>
          </pre>
          <button class="copy-button" data-target="pre-votable">Copy VOTable üìã</button>
        </div>

      </div>
    </div>







  </main>

  <script src="/static/lightcurves.js"></script>
  <script>
    document.querySelectorAll('.copy-button').forEach(button => {
      const preId = button.getAttribute('data-target');
      const pre = document.getElementById(preId);
      button.addEventListener('click', () => {
        navigator.clipboard.writeText(pre.textContent.trim());
        button.textContent = 'Copied! ‚úÖ';
        setTimeout(() => button.textContent = `Copy ${button.dataset.target.split('-')[1].toUpperCase()} üìã`, 1500);
      });
    });
  </script>
</body>

</html>